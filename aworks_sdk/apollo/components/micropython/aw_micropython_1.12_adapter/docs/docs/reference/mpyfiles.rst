.. _mpy_files:

MicroPython .mpy 文件
======================

MicroPython 定义了.mpy文件的概念，该文件是一种二进制容器文件格式，其中包括预编译的代码，并且
可以像普通的.py模块一样导入。可以通过 ``import foo`` 导入 ``foo.mpy`` 文件，只要可以通过导入机制以常规
方式找到 ``foo.mpy`` 。通常，将按顺序搜索 ``sys.path`` 中列出的每个目录。当搜索特定目录时，首先查找 ``foo.py`` ，如果找不到该目录，
则查找 ``foo.mpy`` ，如果没有找到，则在下一个目录中继续搜索。这样 ``foo.py`` 将优先于 ``foo.mpy`` 。

这些.mpy文件可以包含字节码，该字节码通常是通过 ``mpy-cross`` 程序从Python源文件（.py文件）生成的。对于某些体系结构，
.mpy文件也可以包含本机代码，可以通过多种方式生成本机代码，尤其是从C源码生成。

.mpy文件版本控制和兼容性
------------------------------------------

给定的.mpy文件可能与给定的MicroPython系统不兼容，兼容性基于以下几点：

* .mpy文件的版本：文件的版本必须与加载该文件的系统支持的版本匹配。

* .mpy文件中使用的字节码功能：文件和系统之间必须匹配两个字节码功能：unicode支持和字节码中映射查找的
  内联缓存。
  
* 小整数位：.mpy文件将需要最小数量的小整数位，并且加载该文件的系统必须至少支持这么多位。

* Qstr压缩窗口大小：.mpy文件将需要最小的窗口大小以进行qstr解压缩，并且加载该文件的系统西粗具有大于或扥与该大小的窗口。

* 本机体系结构：如果.mpy文件包含本机代码，则它将指定该机器代码的体系结构，并且加载该文件的系统必须支持
  该体系结构代码的执行。

更多内容请参考 `MicroPython .mpy 文件 <https://docs.micropython.org/en/lastest/reference/mpyfiles.html>`_ 。